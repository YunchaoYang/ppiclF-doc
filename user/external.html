

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>External Interface &mdash; ppiclF Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://dpzwick.github.io/ppiclF-doc/user/external.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'v1.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File Output" href="output.html" />
    <link rel="prev" title="The F-File" href="ffile.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ppiclF
          

          
            
            <img src="../_static/ppiclF.gif" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">Algorithms</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../user.html">User Interface</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hfile.html">The H-File</a></li>
<li class="toctree-l2"><a class="reference internal" href="ffile.html">The F-File</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">External Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-variables">Common Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initialization-subroutines">Initialization Subroutines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solve-subroutines">Solve Subroutines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="output.html">File Output</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../acknowledge.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ppiclF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../user.html">User Interface</a> &raquo;</li>
        
      <li>External Interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="external-interface">
<span id="external"></span><h1>External Interface<a class="headerlink" href="#external-interface" title="Permalink to this headline">¶</a></h1>
<p>The following subroutines and variables can be called from an external program’s pre-compilation source code. The source code may be found in an appilcation that you are linking ppiclF to (see <a class="reference internal" href="../examples/Nek5000.html#nek5000-example"><span class="std std-ref">Nek5000 Case</span></a>) or a simple driver program that links to ppiclF (see <a class="reference internal" href="../examples/stokes_2d.html#stokes2d"><span class="std std-ref">Stokes 2D</span></a>).</p>
<p>In what follows, the terms <em>int</em> and <em>real</em> refer to the Fortran integer*4 and real*8 types, which are also the types int and double in C.</p>
<div class="section" id="common-variables">
<h2>Common Variables<a class="headerlink" href="#common-variables" title="Permalink to this headline">¶</a></h2>
<p>The following common variables are stored in memory and may be included by adding the following directive to the top of a routine.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="cp">#include &quot;PPICLF.h&quot;</span>
</pre></div>
</div>
<table border="1" class="docutils align-center" id="id1">
<caption><span class="caption-text">Common variables used and their descriptions.</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="4%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ppiclf_y(j,i)</td>
<td>real</td>
<td>Array of j equations solution for i particle (<span class="math notranslate nohighlight">\(\mathbf{Y}^{(i)}\)</span>).</td>
</tr>
<tr class="row-odd"><td>ppiclf_ydot(j,i)</td>
<td>real</td>
<td>Array of j equations forcing for i particle (<span class="math notranslate nohighlight">\(\dot{\mathbf{Y}}^{(i)}\)</span>).</td>
</tr>
<tr class="row-even"><td>ppiclf_ydotc(j,i)</td>
<td>real</td>
<td>Array of j equations extra storage for i particle.</td>
</tr>
<tr class="row-odd"><td>ppiclf_rprop(j,i)</td>
<td>real</td>
<td>Array of j properties for i particle.</td>
</tr>
<tr class="row-even"><td>ppiclf_npart</td>
<td>int</td>
<td>The number of local particles on the current processor.</td>
</tr>
<tr class="row-odd"><td>ppiclf_pro_fld(i,j,k,e,m)</td>
<td>real</td>
<td>Projected field m at overlap mesh point (i,j,k) on element e.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="initialization-subroutines">
<h2>Initialization Subroutines<a class="headerlink" href="#initialization-subroutines" title="Permalink to this headline">¶</a></h2>
<p>The following subroutines are only to be called once at the begining of a simulation. Note that every routine does not need to be called. The actual subroutines called at setup are problem dependent. However, the subroutines <strong>ppiclf_comm_InitMPI</strong> and <strong>ppiclf_solve_InitParticle</strong> must be called at least once at initialization for every case.</p>
<div class="admonition-ppiclf-comm-initmpi-int-comm-int-id-int-np admonition">
<p class="first admonition-title">ppiclf_comm_InitMPI(int <strong>comm</strong>, int <strong>id</strong>, int <strong>np</strong>)</p>
<p class="last">The user inputs the current MPI communicator <strong>comm</strong> where the current MPI rank is <strong>id</strong> and there are <strong>np</strong> total ranks.</p>
</div>
<div class="admonition-ppiclf-comm-initoverlapmesh-int-ncell-int-lx-int-ly-int-lz-real-xgrid-real-ygrid-real-zgrid admonition">
<p class="first admonition-title">ppiclf_comm_InitOverlapMesh(int <strong>ncell</strong>, int <strong>lx</strong>, int <strong>ly</strong>, int <strong>lz</strong>, real <strong>xgrid</strong>, real <strong>ygrid</strong>, real <strong>zgrid</strong>)</p>
<p>The user inputs the element based mesh. The arrays <strong>xgrid</strong>, <strong>ygrid</strong>, and <strong>zgrid</strong> are of size (<strong>lx,ly,lz,ncell</strong>) and stores the mesh coordinates. Here, <strong>ncell</strong> is the number of local hexahedral elements on rank <strong>id</strong>, with <strong>lx,ly,lz</strong> points in each dimension.</p>
<ul class="last simple">
<li><strong>ncell</strong> <span class="math notranslate nohighlight">\(\leq\)</span> PPICLF_LEE.</li>
<li><strong>lx</strong> == PPICLF_LEX.</li>
<li><strong>ly</strong> == PPICLF_LEY.</li>
<li><strong>lz</strong> == PPICLF_LEZ.</li>
</ul>
</div>
<div class="admonition-ppiclf-io-readparticlevtu-char-1-filein-132 admonition">
<p class="first admonition-title">ppiclf_io_ReadParticleVTU(char*1 <strong>filein(132)</strong>)</p>
<p>The user specifies <strong>filein</strong> with .vtu extension to use as the initial conditions for particles. When this routine is called, the arrays ppiclf_y(j,i) and ppiclf_rprop(j,i) will automatically be filled.</p>
<ul class="last simple">
<li>Note that ppiclf_solve_InitParticle should still be called following this, but with a dummy arguement in place of <strong>y</strong> and <strong>rprop</strong>.</li>
</ul>
</div>
<div class="admonition-ppiclf-io-readwallvtk-char-1-filein-132 admonition">
<p class="first admonition-title">ppiclf_io_ReadWallVTK(char*1 <strong>filein(132)</strong>)</p>
<p>The user specifies <strong>filein</strong> with .vtk extension to use as triangular plane boundaries.</p>
<p>The format of the file is a minimized ASCII VTK format as shown below.</p>
<p>In 3D:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POINTS</span> <span class="n">npoints</span>
<span class="n">p1x</span> <span class="n">p1y</span> <span class="n">p1z</span>
<span class="n">p2x</span> <span class="n">p2y</span> <span class="n">p2z</span>
<span class="o">...</span>
<span class="n">CELLS</span> <span class="n">ncells</span>
<span class="n">n1ip1</span> <span class="n">n1ip2</span> <span class="n">n1ip3</span>
<span class="n">n2ip1</span> <span class="n">n2ip2</span> <span class="n">n2ip3</span>
<span class="o">...</span>
</pre></div>
</div>
<p>and in 2D:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POINTS</span> <span class="n">npoints</span>
<span class="n">p1x</span> <span class="n">p1y</span> <span class="n">p1z</span>
<span class="n">p2x</span> <span class="n">p2y</span> <span class="n">p2z</span>
<span class="o">...</span>
<span class="n">CELLS</span> <span class="n">ncells</span>
<span class="n">n1ip1</span> <span class="n">n1ip2</span>
<span class="n">n2ip1</span> <span class="n">n2ip2</span>
<span class="o">...</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>a tri-element surface mesh is required in 3D problems,</li>
<li>a line-element surface mesh is required in 2D problems,</li>
<li>npoints is total number of points that follow,</li>
<li>pab is point a coordinate in b dimension,</li>
<li>nwalls is total number of walls that follow,</li>
<li>ncipd is the index of the points from 0 to npoints-1 that make up the wall with c being the wall number and d being the arbitrary ordering of points.</li>
</ul>
<p class="last">This format can actually be output using the free finite element mesh generator <a class="reference external" href="https://gmsh.info">Gmsh</a>. The process is to create the appropriate mesh, export as a VTK file, and then remove everything except the format as specified above. <strong>Please make sure there are no blank lines in file.</strong></p>
</div>
<div class="admonition-ppiclf-solve-initwall-real-xp1-real-xp2-real-xp3 admonition">
<p class="first admonition-title">ppiclf_solve_InitWall(real <strong>xp1</strong>, real <strong>xp2</strong>, real <strong>xp3</strong>)</p>
<p>The user manually sets a boundary. This is similar to ppiclf_io_ReadWallVTK, but the user may only want to manually set a single or few walls manually without a VTK file.</p>
<ul class="last simple">
<li>The inputs are all vectors of length two (2D) or three (3D).</li>
<li><strong>xp1</strong> stores coordinates (p1x, p1y, p1z) as in the VTK file.</li>
<li><strong>xp2</strong> stores coordinates (p2x, p2y, p2z) as in the VTK file.</li>
<li><strong>xp3</strong> stores coordinates (p3x, p3y, p3z) as in the VTK file.</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-initneighborbin-real-w admonition">
<p class="first admonition-title">ppiclf_solve_InitNeighborBin(real <strong>W</strong>)</p>
<p class="last">The user specifies <strong>W</strong> as the minimum interaction distance to resolve. See <a class="reference internal" href="../algorithms/particle_storage.html#part-storage"><span class="std std-ref">Particle Storage</span></a>.</p>
</div>
<div class="admonition-ppiclf-solve-initsuggesteddir-char-1-dir admonition">
<p class="first admonition-title">ppiclf_solve_InitSuggestedDir(char*1 <strong>dir</strong>)</p>
<p>The user inputs <strong>dir</strong> dimension which lets the bin generation algorithm attempt to create more bins in chosen dimension.</p>
<ul class="last simple">
<li><strong>dir</strong> = ‘x’, ‘y’, or ‘z’.</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-initperiodicx-real-a-real-b admonition">
<p class="first admonition-title">ppiclf_solve_InitPeriodicX(real <strong>a</strong>, real <strong>b</strong>)</p>
<ul class="last simple">
<li>The user sets periodicity in the y-z planes at x = <strong>a</strong> and x = <strong>b</strong>.</li>
<li>Note: <strong>a</strong> &lt; <strong>b</strong>.</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-initperiodicy-real-a-real-b admonition">
<p class="first admonition-title">ppiclf_solve_InitPeriodicY(real <strong>a</strong>, real <strong>b</strong>)</p>
<p>The user sets periodicity in the x-z planes at y = <strong>a</strong> and y = <strong>b</strong>.</p>
<ul class="last simple">
<li><strong>a</strong> &lt; <strong>b</strong>.</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-initperiodicz-real-a-real-b admonition">
<p class="first admonition-title">ppiclf_solve_InitPeriodicZ(real <strong>a</strong>, real <strong>b</strong>)</p>
<p>The user sets periodicity in the x-y planes at z = <strong>a</strong> and z = <strong>b</strong>.</p>
<ul class="last simple">
<li><strong>a</strong> &lt; <strong>b</strong>.</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-initgaussianfilter-real-f-real-a-int-iflg admonition">
<p class="first admonition-title">ppiclf_solve_InitGaussianFilter(real <strong>f</strong>, real <strong>a</strong>, int <strong>iflg</strong>)</p>
<p>The Gaussian filter half-width for projection <span class="math notranslate nohighlight">\(\delta_f\)</span> is <strong>f</strong> (see <a class="reference internal" href="../algorithms/overlap_mesh.html#overlap-mesh"><span class="std std-ref">Overlap Mesh</span></a>). The value <strong>a</strong> is the percent of the r = 0 value that the Gaussian filter is computationally allowed to decay to. The flag <strong>iflg</strong> sets if particles should be mirrored and then projected across boundaries or not.</p>
<ul class="last simple">
<li><strong>a</strong> &lt; 1.0.</li>
<li><strong>iflg</strong> = 0 (no mirror) or 1 (mirror).</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-initboxfilter-real-f-int-iflg admonition">
<p class="first admonition-title">ppiclf_solve_InitBoxFilter(real <strong>f</strong>, int <strong>iflg</strong>)</p>
<p>The box filter half-width for projection <span class="math notranslate nohighlight">\(\delta_f\)</span> is <strong>f</strong> (see <a class="reference internal" href="../algorithms/overlap_mesh.html#overlap-mesh"><span class="std std-ref">Overlap Mesh</span></a>). The flag <strong>iflg</strong> sets if particles should be mirrored and then projected across boundaries or not.</p>
<ul class="last simple">
<li><strong>iflg</strong> = 0 (no mirror) or 1 (mirror).</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-initparticle-int-imethod-int-ndim-int-iendian-int-npart-real-y-real-rprop admonition">
<p class="first admonition-title">ppiclf_solve_InitParticle(int <strong>imethod</strong>, int <strong>ndim</strong>, int <strong>iendian</strong>, int <strong>npart</strong>, real <strong>y</strong>, real <strong>rprop</strong>)</p>
<p>The user also initializes <span class="math notranslate nohighlight">\(\mathbf{Y}_0\)</span>, which is the initial condition of <span class="math notranslate nohighlight">\(\mathbf{Y}\)</span> for the system of equations. The user also sets the integration method <strong>imethod</strong>, the problem dimension <strong>ndim</strong>, the byte ordering <strong>iendian</strong>, and the number of particles being initializied on the current rank <strong>npart</strong>.</p>
<ul class="last simple">
<li><strong>imethod</strong> = +/-1 (RK3). When <strong>imethod</strong> is negative, the user is in chage of looping through both steps <strong>AND</strong> stages.</li>
<li><strong>ndim</strong> = 2 or 3.</li>
<li><strong>iendian</strong> = 0 (little endian) or 1 (big endian).</li>
<li><strong>npart</strong> <span class="math notranslate nohighlight">\(\geq\)</span> 0.</li>
</ul>
</div>
</div>
<div class="section" id="solve-subroutines">
<h2>Solve Subroutines<a class="headerlink" href="#solve-subroutines" title="Permalink to this headline">¶</a></h2>
<p>The following subroutines can be called at every time step. Note that every routine does not need to be called. The actual subroutines called at each time step are problem dependent. However, the subroutine <strong>ppiclf_solve_IntegrateParticle</strong> must be called at least once every time step for any opperations to be performed.</p>
<div class="admonition-ppiclf-solve-interpfielduser-int-ifld-real-fld admonition">
<p class="first admonition-title">ppiclf_solve_InterpFieldUser(int <strong>ifld</strong>, real <strong>fld</strong>)</p>
<p>The user sets which field array <strong>fld</strong> of same dimensions set in initialization call to ppiclf_comm_InitOverlapMesh routine is used to interpolate to index in property array ppiclf_rprop(<strong>ifld</strong>,i) for the i particle. This routine may be called multiple times to interpolate multiple fields.</p>
<ul class="last simple">
<li><strong>ifld</strong> <span class="math notranslate nohighlight">\(\leq\)</span> PPICLF_LRP.</li>
</ul>
</div>
<div class="admonition-ppiclf-solve-integrateparticle-int-istep-int-iostep-real-dt-real-time admonition">
<p class="first admonition-title">ppiclf_solve_IntegrateParticle(int <strong>istep</strong>, int <strong>iostep</strong>, real <strong>dt</strong>, real <strong>time</strong>)</p>
<p>This routine must be called every time step and uses the initial integration method to advance <span class="math notranslate nohighlight">\(\mathbf{Y}\)</span> in time. The inputs are the current <strong>time</strong>, the current time step <strong>dt</strong> to advance by, the current time step number <strong>istep</strong>, and will output solution files every <strong>iostep</strong> number of time steps. Note that the user must call this routine every time step for the system to be integrated. When <strong>imethod</strong> is initialized to be a negative number, this routine must also be called every stage as well.</p>
<ul class="last simple">
<li><strong>istep</strong> <span class="math notranslate nohighlight">\(\geq\)</span> 0.</li>
<li><strong>iostep</strong> <span class="math notranslate nohighlight">\(\geq\)</span> 0.</li>
<li><strong>dt</strong> <span class="math notranslate nohighlight">\(\geq\)</span> 0.0.</li>
<li><strong>time</strong> <span class="math notranslate nohighlight">\(\geq\)</span> 0.0.</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, David Zwick

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>